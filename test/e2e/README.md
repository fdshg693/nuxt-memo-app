# E2E テスト

このディレクトリには、Playwrightを使用したEnd-to-End（E2E）テストが含まれています。

## テスト概要

### カバレッジ範囲

1. **ナビゲーションワークフロー** (`navigation.spec.ts`)
   - ホームページから各ページへの基本ナビゲーション
   - 外部リンクの確認
   - SQL問題リンクの動作

2. **SQLラーニングワークフロー** (`sql-learning.spec.ts`)
   - SQL問題の実行とフィードバック
   - SQL問題間のナビゲーション
   - AI支援機能の確認
   - 答え合わせ機能
   - エラーハンドリング

3. **認証ワークフロー** (`authentication.spec.ts`)
   - ログインページの表示と機能
   - フォームバリデーション
   - 保護されたページへのアクセス制御
   - 認証状態の管理

4. **クイズワークフロー** (`quiz.spec.ts`)
   - クイズページの基本レイアウト
   - 問題との相互作用
   - 複数コンポーネントの並行動作
   - レスポンシブデザイン

5. **ジャンケンゲームワークフロー** (`janken.spec.ts`)
   - ゲームの基本機能
   - 全ての手（グー・チョキ・パー）での動作
   - スコアシステム
   - 連続プレイ

6. **統合ワークフロー** (`integration.spec.ts`)
   - 完全なユーザージャーニー
   - マルチページナビゲーション
   - エラーハンドリングとリカバリー
   - データ永続性とセッション管理

## 実行方法

### 前提条件
- Node.js がインストールされていること
- 依存関係がインストールされていること (`npm install`)

### テスト実行コマンド

```bash
# 全てのE2Eテストを実行
npm run test:e2e

# UIモードでテストを実行（ブラウザで確認可能）
npm run test:e2e:ui

# デバッグモードでテストを実行
npm run test:e2e:debug

# テストレポートを表示
npm run test:e2e:report
```

### 個別テストの実行

```bash
# 特定のテストファイルのみ実行
npx playwright test navigation.spec.ts

# 特定のテストケースのみ実行
npx playwright test --grep "ホームページから各ページへの基本ナビゲーション"
```

## テスト環境

- **ブラウザ**: Chromium, Firefox, WebKit
- **ベースURL**: http://127.0.0.1:3000
- **開発サーバー**: 自動起動・停止

## ヘルパー関数

`helpers.ts` には共通で使用するユーティリティ関数が定義されています：

- `mockAuthentication()`: 認証状態をモック
- `clearAuthentication()`: 認証状態をクリア
- `waitForPageLoad()`: ページ読み込み完了まで待機
- `navigateToFirstSqlQuestion()`: 最初のSQL問題に移動
- `testResponsiveLayout()`: レスポンシブデザインのテスト
- `checkJapaneseText()`: 日本語テキストの表示確認

## 注意事項

1. **認証のモック**: 実際のAPI認証ではなく、Cookieベースのモック認証を使用
2. **外部依存**: OpenAI APIなどの外部サービスは実際には呼び出されません
3. **データ**: テスト用の静的データを使用
4. **ブラウザ**: CI環境では自動的にヘッドレスモードで実行されます

## トラブルシューティング

### よくある問題

1. **タイムアウトエラー**
   - ページの読み込みが遅い場合は `waitForPageLoad()` の timeout を調整
   - CI環境では workers を 1 に設定済み

2. **要素が見つからない**
   - 動的コンテンツの場合は適切な待機処理を追加
   - セレクターが正しいかブラウザの開発者ツールで確認

3. **認証関連**
   - 認証が必要なテストでは `mockAuthentication()` が正しく実行されているか確認

## CI/CD

このE2Eテストは以下の環境で自動実行されます：

- Pull Request作成時
- メインブランチへのマージ時
- 定期実行（必要に応じて）

テスト結果はGitHub Actionsのアーティファクトとして保存され、レポートを確認できます。